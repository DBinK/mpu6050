# MPU6050 DMP 库 

## 摘要 

该库主要源自 Geir Istad 的贡献，并已作为 pip 可安装包发布。

该库旨在简化惯性测量单元 (IMU) 内数字运动处理器 (DMP) 以及其他运动数据的使用。

该软件包的主要重点是提供设备在空间中的方向作为四元数，可转换为欧拉角。使用 DMP 模块内的扩展卡尔曼滤波器 (EKF) 对生成的数据进行处理和去噪。

要安装此软件包，请执行以下命令：

``` 
pip install mpu6050
```

我对该库的主要贡献是增强 DMP 结果、提供详细示例、描述用法以及使该库可通过 pip 安装。除了 Geir Istad 所做的伟大工作外，在实践中也遇到了一些问题。

下面列出了增强功能： - 使用 SciPy 库增强了四元数到欧拉角度的转换（滚动、俯仰、偏航） - 使用基于四元数的新公式重写了线性（世界坐标系）加速度 - 更好地访问 DMP 频率 - 易于理解、实际例子及详​​细解释 - pip-installable

**此库已在 Nvidia Jetson 上使用 I2C 通信协议进行测试。**

该库也可用于 MPU9250。但是，AK8963 模块提供的磁力计数据无法访问。

## 简介 

MPU6050 是一款多功能加速度计陀螺仪芯片，具有六轴传感能力和 16 位测量分辨率。

该芯片因其高精度和高性价比而广受欢迎，成为DIY爱好者甚至商业产品的首选。

MPU6050 中陀螺仪和加速度计的组合形成了所谓的惯性测量单元 (IMU)，该单元可应用于手机、平板电脑、机器人等各个领域。

数字运动处理器 (DMP) 是某些运动传感芯片的强大功能，例如 MPU6050，它是一款多功能加速度计和陀螺仪芯片，具有六轴传感功能和 16 位测量分辨率。

DMP 是一个板载处理器，可处理复杂的传感器处理和融合，将这些任务从微控制器上卸载。

这样可以实现更快、更准确的传感器读数，这在实时运动跟踪至关重要的应用中尤其重要。

## 主要贡献 
在这里，我们将讨论该库中的关键更改以及为提高可用性和对 MPU6050 功能的访问而进行的增强功能。 

### 1.欧拉角 

DMP 的实际输出之一是四元数，它精确地表示 IMU 在空间中的方向。虽然四元数很有用，但通常需要欧拉角，其中包括横滚角、俯仰角和偏航角。

以前的库在从四元数到欧拉角的转换方面存在问题，导致不准确。新的转换方法利用 scipy 来提高准确性。通过在 Nvidia Jetson 上进行大量实验，发现结果令人满意。

### 2. 世界坐标系加速度 

从 IMU 获取的加速度数据以与 IMU 轴对齐的本体坐标系表示。

然而，在惯性导航系统 (INS) 领域，访问世界坐标系加速度矢量对于精确导航至关重要。下图描述了世界坐标系和身体坐标系轴的方向：

<p align="center"><img src="https://ars.els-cdn.com/content/image/3-s2.0-B9780128131893000162-f16-01-9780128131893.jpg" ></p>

使用四元数的向量旋转是通过以下公式实现的：

$$A_p=q\times A\times q^*$$

其中$q^*$表示四元数q的共轭，$A_p$表示旋转后的原始向量$A$。

通过该方法，提供了可靠的世界坐标系加速。例如，在空间中任意方向的静止情况下，此方法给出 $(0,0,g)$ 作为加速度矢量。

旧库在计算世界坐标系加速度时存在数学问题，结果不切实际。

请注意，此方法在 DMP 频率为 40Hz 或更低时效果最佳。通过将 DMP 配置为更高的频率，噪声的影响将不可忽略。

**由于偏航是相对于 IMU 的初始航向，因此必须根据航向修正器进行旋转。**

### 3. DMP频率的获取 

要在旧库中设置 DMP 的频率，必须参考 MPU 常量并更改寄存器以将 DMP 的频率设置为特定值。

这里，通过给MPU模块赋值，频率被自动配置。 **请注意，程序必须足够快才能跟上 DMP 频率。否则，FIFO 寄存器将溢出。**

值得注意的是，为了便于使用（即等待 FIFO 数据），库的结构略有变化。

### 4. 示例 

提供了三个示例，详细说明了为从 MPU6050 传感器获得准确数据而进行的计算。这些示例易于阅读并且不会造成任何混乱。

* **example0_raw_data**：提供DMP融合前后的加速度计和陀螺仪数据。还提供了如何计算这些值的详细说明。 
* **example1_rollpitchyaw**：提供以度为单位的横滚、俯仰和偏航旋转。
请注意，偏航是相对于 IMU 的初始航向的。因此，它有一个偏移，并且随着时间的推移可能会有小的漂移。 
* **example2_linear_accel**：提供世界坐标系加速度。

由于偏航相对于 IMU 的初始航向，因此必须根据航向修正器旋转加速度数据。

### 5. 可在 PyPI 上使用 

我很荣幸地声明，这个综合库现在可在 PyPI 上使用，包含所解释的所有功能，可以通过执行简单的命令来访问这些功能：

```
pip install mpu6050
```

此命令还将安装“quat”和“smbus”库，这对于库的正常运行至关重要。

有关“quat”库的更多详细信息，“quat”库是一个用于处理四元数和向量的简洁库（也由 Geir Istad 开发），请参阅 GitHub 存储库 [quat](https://github.com/OmidAlek/quat)。